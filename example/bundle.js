// deno-lint-ignore-file
var b=Object.defineProperty;var r=(e,n)=>b(e,"name",{value:n,configurable:!0});var c=r(e=>document.getElementById(e),"$"),N=c("logger"),a=c("out"),x=c("getFilesBtn"),v=c("getFileBtn"),f=c("saveFileBtn"),P=0,o=r((e,n=null,s=null)=>{if(N){let t=e+"   ";n&&(t+=n),s&&(t+=s),P++,N.textContent=P+" - "+t+`
`+N.textContent}},"log");var F="http://localhost:9000";var m=new Map,i=console.log,h=0,p=r((e,n)=>{let s=h++;return i(`RPC msg ${s} called ${e}`),new Promise((t,g)=>{m.set(s,(d,C)=>{if(d)return g(new Error(d));t(C)}),fetch(F+"/",{method:"POST",mode:"cors",body:JSON.stringify({msgID:s,procedure:e,params:n})})})},"Call"),k=r(e=>(i=e||console.log,new Promise((n,s)=>{let t=new EventSource(F+"/rpc_registration");i("CONNECTING"),t.addEventListener("open",()=>{i("events.onopen - CONNECTED"),n("ok")}),t.addEventListener("error",g=>{switch(t.readyState){case EventSource.OPEN:i("CONNECTED");break;case EventSource.CONNECTING:i("CONNECTING");break;case EventSource.CLOSED:s("closed"),i("DISCONNECTED");break}}),t.addEventListener("message",g=>{let{data:d}=g,C=JSON.parse(d),{msgID:l,error:u,result:E}=C;if(u&&(console.log("sse-rpc got error - ",u),i(`ARPC msg ${l} returned an error - #{error}`)),l>=0&&E){if(i(`ARPC msg ${l} returned - ${E}`),!m.has(l)){console.log("no callback found for ",l);return}let L=m.get(l);m.delete(l),L(u,E)}})})),"Initialize");var y="example",T="./test.txt";x.onclick=()=>{o('"Get File List" button clicked!'),p("GetDirectory",{root:"./",folder:"example"}).then(e=>{if(typeof e=="string"){let n="File list:  ",s=JSON.parse(e);for(let t of s)t.isFile&&(n=n+t.name+", ");a.innerHTML=n}}).catch(e=>o(e))};v.onclick=()=>{o('"Get-File" button clicked!'),p("GetFile",{folder:y,fileName:T}).then(e=>{typeof e=="string"&&(e.startsWith('"')&&(e=e.slice(1,e.length-1)),typeof e=="string"&&(a.innerHTML=e),f.removeAttribute("disabled"))}).catch(e=>o(e))};f.onclick=()=>{o('"Save-File" button clicked!'),p("SaveFile",{folder:y,fileName:T,content:a.textContent}).then(e=>{typeof e=="string"&&o("Result - "+e),a.textContent="",f.setAttribute("disabled","")}).catch(e=>o(e))};k(o).then(()=>{o("Initialized RPC services!")});o("App started!");
